@{
    ViewData["Title"] = "Главная";
}

<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h3 class="card-title mb-0">
                        <i class="fas fa-tachometer-alt me-2"></i>Панель управления
                    </h3>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="card bg-info text-white">
                                <div class="card-body text-center">
                                    <i class="fas fa-list fa-3x mb-3"></i>
                                    <h5>Справочник СВС</h5>
                                    <p class="mb-0">Управление материалами</p>
                                    <small id="lastUpdate">Последнее обновление: неизвестно</small>
                                </div>
                                <div class="card-footer">
                                    <a href="@Url.Action("SvsCatalog", "Home")" class="btn btn-light btn-sm w-100">
                                        <i class="fas fa-arrow-right me-1"></i>Перейти
                                    </a>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-3">
                            <div class="card bg-success text-white">
                                <div class="card-body text-center">
                                    <i class="fas fa-building fa-3x mb-3"></i>
                                    <h5>Управления образования</h5>
                                    <p class="mb-0">УО и организации</p>
                                    <small id="uoCount">УО: 0</small>
                                </div>
                                <div class="card-footer">
                                    <a href="@Url.Action("EducationDepartments", "Home")" class="btn btn-light btn-sm w-100">
                                        <i class="fas fa-arrow-right me-1"></i>Перейти
                                    </a>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-3">
                            <div class="card bg-warning text-white">
                                <div class="card-body text-center">
                                    <i class="fas fa-upload fa-3x mb-3"></i>
                                    <h5>Импорт данных</h5>
                                    <p class="mb-0">CSV, DBF файлы</p>
                                    <small id="importCount">Импортов: 0</small>
                                </div>
                                <div class="card-footer">
                                    <a href="@Url.Action("DataImport", "Home")" class="btn btn-light btn-sm w-100">
                                        <i class="fas fa-arrow-right me-1"></i>Перейти
                                    </a>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-3">
                            <div class="card bg-danger text-white">
                                <div class="card-body text-center">
                                    <i class="fas fa-exchange-alt fa-3x mb-3"></i>
                                    <h5>Сопоставление данных</h5>
                                    <p class="mb-0">СВС ↔ Продукты</p>
                                    <small id="mappingCount">Сопоставлений: 0</small>
                                </div>
                                <div class="card-footer">
                                    <a href="@Url.Action("DataMapping", "Home")" class="btn btn-light btn-sm w-100">
                                        <i class="fas fa-arrow-right me-1"></i>Перейти
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    loadDashboardStats();
});

async function loadDashboardStats() {
    try {
        // Загружаем статистику справочника СВС
        const svsResponse = await fetch('/api/svs/stats');
        const svsResult = await svsResponse.json();
        if (svsResult.success) {
            document.getElementById('lastUpdate').textContent = 
                `Последнее обновление: ${new Date().toLocaleDateString()}`;
        }
        
        // Загружаем количество УО
        const uoResponse = await fetch('/api/educationdepartments');
        const uoResult = await uoResponse.json();
        if (uoResult.success) {
            document.getElementById('uoCount').textContent = `УО: ${uoResult.data.length}`;
        }
        
        // Загружаем количество импортов
        const importResponse = await fetch('/api/dataimport/history');
        const importResult = await importResponse.json();
        if (Array.isArray(importResult)) {
            document.getElementById('importCount').textContent = `Импортов: ${importResult.length}`;
        }
        
        // Загружаем количество сопоставлений
        const mappingResponse = await fetch('/api/svs/mappings');
        const mappingResult = await mappingResponse.json();
        if (mappingResult.success) {
            document.getElementById('mappingCount').textContent = 
                `Сопоставлений: ${mappingResult.mappedCount || 0}`;
        }
    } catch (error) {
        console.error('Ошибка загрузки статистики:', error);
    }
}
</script>